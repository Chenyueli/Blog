---
layout: post
title: "Web网站性能优化（1）"
date: 2017-03-19
excerpt: "yahoo性能优化14条："
tag:
- 性能

comments: false
---
来源：[ 网站优化 14条--雅虎十四条优化原则](http://blog.csdn.net/u010648555/article/details/50721751)

[YaHoo Web优化的14条法则](http://www.cnblogs.com/silverLee/archive/2009/11/05/1596453.html)

[前端工程与性能优化](http://kb.cnblogs.com/page/213726/)

<pre>
1. 尽可能地减少HTTP的请求				content
2. 使用CDN					server
3. 添加Experes/cache-control头			server
4. Gzip组件					server
5. 将CSS样式放在页面的上方			CSS
6. 将脚本移动到底部				Javascript
7. 避免使用CSS的Expressions			CSS
8. 将JS和CSS独立成外部文件			JS/CSS
9. 减少DNS查询					content
10. 压缩JS和CSS(包括内联的）			JS/CSS
11. 避免重定向					server
12. 移除重复的脚本				JS
13. 配置实体标签（ETags)				CSS
14. 使AJAX缓存					JS
</pre>


在firefox下有一个插件yslow，集成在firebug中，你可以用它很方便地来看看自己的网站在这几个方面的表现。

### 1. 尽可能地减少HTTP的请求
- 合并css,js
- 背景图片css sprites

首页css和js直接写在页面文件里面，而不是外部引用。因为首页的访问量太大了，这么做可以减少两个请求书。国内很多门户都是这么做的。

减少HTTP请求次数是性能优化的起点。这最提高首次访问的效率起到很重要的作用。40-60%的日常访问是首次访问，因此为首次访问者加快页面访问速度是用户体验的关键。

将首页的几十个小图标合并为一个，通过CSS控制它们的显示，减少了HTTP请求数。

### 5. 将CSS样式放在页面的上方
浏览器在CSS完全加载完毕之后再去渲染


### 8. 将JS和CSS独立成外部文件
把css和js写在页面内容可以减少2次请求，但也增 大了页面的大小。如果已经对css和js做了缓存，那也就没有2次多余的http请求了。当然，我在前面中也说过，有些特殊的页面开发人员还是会选择内联 的css和js文件。有些特殊的页面开发人员还是会选择内联样式。


### 9. 减少DNS查询
在域名和ip地址之间的转换工作称为域名解析，也称DNS查询。

一次DNS的解析过程会消耗20-120毫秒的 时间,在dns查询结束之前，浏览器不会下载该域名下的任何东西。所以减少dns查询的时间可以加快页面的加载速度。yahoo的建议一个页面所包含的域 名数尽量控制在2-4个。


### 10. 压缩JS和CSS
压缩js和css的左右很显然，减少页面字节数。容量小页面加载速度自然也就快。


### 12. 移除重复的脚本
避免重复的代码,开发可重用代码



# 二、浏览器的加载、渲染、解析原理
浏览器5个常驻线程：




1. 浏览器GUI渲染线程
2. javascript引擎线程
3. 浏览器定时器触发线程（setTimeout）
4. 浏览器事件触发线程
5. 浏览器http异步请求线程（.jpg <link />这类请求）

发现第3个线程，我们便知道，如果在js内使用setTimeout()那么会调用另一个线程。

**注意**：这里也涉及到 阻塞 的现象，当js引擎线程（第二个）进行时，会挂起其他一切线程，这个时候3、4、5这三类线线程也会产生不同的异步事件（这句话不懂啊），由于 javascript引擎线程为单线程，所以代码都是先压到队列，采用先进先出的方式运行，事件处理函数，timer函数也会压在队列中，不断的从队头取出事件，这就叫：javascript-event-loop。

1.加载

- 图片、css文件异步请求，不影响html文档进行加载
- js html文档挂起,等待文档中js文件加载完毕，并等待解析执行完毕，才恢复html文档渲染进程。
- 不要在外部调用的js文件中调用运行时间较长的函数，如果一定要用，可以使用setTimeout函数。

因此：将外部`js`文件放在`</body>`前，避免JS阻塞。

2.解析

1. html文档解析（生成dom树）
2. css解析（生成样式表对象）
3. js解析（边加载边解析）



3.渲染

*渲染最大的一个困难就是为每一个dom节点计算符合他的最终样式。*

为每个元素查找到匹配规则的样式，需要遍历整个规则表。

遍历规则：从上往下，**自右向左**
	
- 选择器迭代太深，会造成太多的无用遍历。
- **共享样式数据**可以减少计算。
- 设置元素属性或编写js文件时，尽量少修改`DOM`,减少重绘、重新布局的消耗。


来源：
<a href = "http://www.jianshu.com/p/e141d1543143" target = "_blank">浏览器~加载，解析，渲染</a>

<a href = "http://www.51testing.com/html/38/225738-220986.html" target = "_blank">浏览器加载和渲染html的顺序</a>


# 三、常见的前端优化


<table border="1">
<thead>
<tr><th>优化方向</th><th>优化手段</th></tr>
</thead>
<tbody>
<tr><td>请求数量</td><td>合并脚本和样式表，CSS sprites,拆分初始化负载，划分主域</td></tr>
<tr><td>请求宽带</td><td>开启Gzip，精简js，移除重复脚本，图像优化</td></tr>
<tr><td>缓存利用</td><td>使用CDN，使用外部js和CSS,添加Expires,减少DNS查询，配置ETag,使Ajax可缓存</td></tr>
<tr><td>页面结构</td><td>将样式表放在顶部，将脚本放在底部，今早刷新文档的输出</td></tr>
<tr><td>代码校验</td><td>避免CSS表达式，避免重定向</td></tr>
</tbody>
</table>

## 项目中的实现：

## html
减少冗余标签、

## css
- 压缩，减少字节数
- 合并文件、图片，减少首页HTTP请求
- 优化：减少嵌套层，减少CSS表达式计算

## Javascript
- 压缩
- 组件化，使用继承，减少冗余代码，提高代码复用率